"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.redirectToShopifyOrAppRoot = void 0;
var tslib_1 = require("tslib");
var server_runtime_1 = require("@remix-run/server-runtime");
function redirectToShopifyOrAppRoot(request, params, responseHeaders) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
        var api, url, host, shop, redirectUrl, _a;
        return tslib_1.__generator(this, function (_b) {
            switch (_b.label) {
                case 0:
                    api = params.api;
                    url = new URL(request.url);
                    host = api.utils.sanitizeHost(url.searchParams.get('host'));
                    shop = api.utils.sanitizeShop(url.searchParams.get('shop'));
                    if (!api.config.isEmbeddedApp) return [3 /*break*/, 2];
                    return [4 /*yield*/, api.auth.getEmbeddedAppUrl({ rawRequest: request })];
                case 1:
                    _a = _b.sent();
                    return [3 /*break*/, 3];
                case 2:
                    _a = "/?shop=".concat(shop, "&host=").concat(encodeURIComponent(host));
                    _b.label = 3;
                case 3:
                    redirectUrl = _a;
                    throw (0, server_runtime_1.redirect)(redirectUrl, { headers: responseHeaders });
            }
        });
    });
}
exports.redirectToShopifyOrAppRoot = redirectToShopifyOrAppRoot;
//# sourceMappingURL=redirect-to-shopify-or-app-root.js.map