"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ensureSessionTokenSearchParamIfRequired = void 0;
var tslib_1 = require("tslib");
var redirect_to_bounce_page_1 = require("./redirect-to-bounce-page");
var SESSION_TOKEN_PARAM = 'id_token';
var ensureSessionTokenSearchParamIfRequired = function (params, request) { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
    var api, logger, url, shop, searchParamSessionToken, isEmbedded;
    return tslib_1.__generator(this, function (_a) {
        api = params.api, logger = params.logger;
        url = new URL(request.url);
        shop = url.searchParams.get('shop');
        searchParamSessionToken = url.searchParams.get(SESSION_TOKEN_PARAM);
        isEmbedded = url.searchParams.get('embedded') === '1';
        if (api.config.isEmbeddedApp && isEmbedded && !searchParamSessionToken) {
            logger.debug('Missing session token in search params, going to bounce page', { shop: shop });
            (0, redirect_to_bounce_page_1.redirectToBouncePage)(params, url);
        }
        return [2 /*return*/];
    });
}); };
exports.ensureSessionTokenSearchParamIfRequired = ensureSessionTokenSearchParamIfRequired;
//# sourceMappingURL=ensure-session-token-search-param-if-required.js.map