"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.renderAppBridge = void 0;
var app_bridge_url_1 = require("../../helpers/app-bridge-url");
var add_response_headers_1 = require("../../helpers/add-response-headers");
function renderAppBridge(_a, request, redirectTo) {
    var _b;
    var config = _a.config;
    var redirectToScript = '';
    if (redirectTo) {
        var destination = new URL(redirectTo.url, config.appUrl);
        var target = (_b = redirectTo.target) !== null && _b !== void 0 ? _b : '_top';
        redirectToScript = "<script>window.open(".concat(JSON.stringify(destination.toString()), ", ").concat(JSON.stringify(target), ")</script>");
    }
    var responseHeaders = new Headers({
        'content-type': 'text/html;charset=utf-8',
    });
    (0, add_response_headers_1.addDocumentResponseHeaders)(responseHeaders, config.isEmbeddedApp, new URL(request.url).searchParams.get('shop'));
    throw new Response("\n      <script data-api-key=\"".concat(config.apiKey, "\" src=\"").concat((0, app_bridge_url_1.appBridgeUrl)(), "\"></script>\n      ").concat(redirectToScript, "\n    "), { headers: responseHeaders });
}
exports.renderAppBridge = renderAppBridge;
//# sourceMappingURL=render-app-bridge.js.map